!function(){var e={99:function(e,t){var l;!function(){"use strict";var o={}.hasOwnProperty;function n(){for(var e=[],t=0;t<arguments.length;t++){var l=arguments[t];if(l){var r=typeof l;if("string"===r||"number"===r)e.push(l);else if(Array.isArray(l)){if(l.length){var a=n.apply(null,l);a&&e.push(a)}}else if("object"===r){if(l.toString!==Object.prototype.toString&&!l.toString.toString().includes("[native code]")){e.push(l.toString());continue}for(var s in l)o.call(l,s)&&l[s]&&e.push(s)}}}return e.join(" ")}e.exports?(n.default=n,e.exports=n):void 0===(l=function(){return n}.apply(t,[]))||(e.exports=l)}()}},t={};function l(o){var n=t[o];if(void 0!==n)return n.exports;var r=t[o]={exports:{}};return e[o](r,r.exports,l),r.exports}l.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return l.d(t,{a:t}),t},l.d=function(e,t){for(var o in t)l.o(t,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=window.wp.element;function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o])}return e},t.apply(this,arguments)}const o=[];class n{static get array(){return o}static add(e,t){return-1===o.findIndex((t=>t.id===e))&&(o.push({id:e,clientId:t}),!0)}static remove(e){let t=o.findIndex((t=>t.clientId===e));return-1!==t?(o.splice(t,1),!0):-1===t||!1}static update(e,t){return!!this.remove(t)&&this.add(e,t)}static ids(){return o.map((e=>e.id))}static contains(e,t){return-1!==o.findIndex((l=>l.id===e&&l.clientId!==t))}}var r=l(99),a=l.n(r),s=window.wp.components;class i extends e.Component{render(){const{data:t,className:l,isSelected:o,isDisabled:n,onSelected:r}=this.props;let i={className:a()("foogallery-modal__item",l,{"is-selected":o,"is-disabled":n})};if(!n){let e={onClick:e=>{e.stopPropagation(),r(t.id)},onKeyPress:e=>{e.stopPropagation(),32!==e.which&&13!==e.which||r(t.id)},tabIndex:0};i={...i,...e}}let c=t.thumbnail?(0,e.createElement)("img",{className:"foogallery-modal__item-thumbnail",src:t.thumbnail,alt:t.name}):(0,e.createElement)(s.Dashicon,{className:"foogallery-modal__item-thumbnail",icon:"format-image"});return(0,e.createElement)("figure",i,c,(0,e.createElement)("figcaption",{className:"foogallery-modal__item-caption"},t.name),o?(0,e.createElement)(s.Dashicon,{className:"foogallery-modal__icon-selected",icon:"yes"}):null,n?(0,e.createElement)(s.Dashicon,{className:"foogallery-modal__icon-disabled",icon:"no"}):null)}}i.defaultProps={data:{},className:"",isSelected:!1,isDisabled:!1,onSelected:_.noop};var c=window.wp.i18n;class d extends e.Component{constructor(){super(...arguments),this.state={id:this.props.currentId,data:null,isLoading:!1,query:""},this.onReloadClick=this.onReloadClick.bind(this),this.onInsertClick=this.onInsertClick.bind(this),this.onQueryChange=this.onQueryChange.bind(this)}async fetchGalleries(){this.setState({data:null,isLoading:!0});let e=await wp.apiFetch({path:"/foogallery/v1/galleries/"});e.forEach((e=>{e.lowerName="string"==typeof e.name?e.name.toLowerCase():""})),this.setState({data:e,isLoading:!1})}componentDidMount(){const{data:e,isLoading:t}=this.state;null!==e||t||this.fetchGalleries()}onReloadClick(e){e.stopPropagation(),this.fetchGalleries()}onInsertClick(e){e.stopPropagation();const{onRequestModalClose:t,onRequestGalleryInsert:l}=this.props,{id:o}=this.state;0!==o&&(l(o),t())}onQueryChange(e){this.setState({query:e.target.value})}render(){const{isModalOpen:t,className:l,title:o,insert:n,reload:r,search:i,onRequestModalClose:c}=this.props;if(!t)return null;const{id:d,isLoading:u,query:p}=this.state;return(0,e.createElement)(s.Modal,{className:a()("foogallery-modal",l),title:o,onRequestClose:c},(0,e.createElement)("div",{className:"foogallery-modal__content"},(0,e.createElement)("div",{className:"foogallery-modal__content-container"},this.renderContent())),(0,e.createElement)("div",{className:"foogallery-modal__footer"},(0,e.createElement)("input",{type:"text",className:"foogallery-modal__footer-search",placeholder:i,value:p,onChange:this.onQueryChange}),(0,e.createElement)("div",{className:"foogallery-modal__footer-buttons"},(0,e.createElement)(s.Button,{isSecondary:!0,icon:"update",label:r,onClick:this.onReloadClick,disabled:u}),(0,e.createElement)(s.Button,{isPrimary:!0,onClick:this.onInsertClick,disabled:0===d},n))))}renderContent(){const{disable:t,empty:l,loading:o}=this.props,{id:n,data:r,isLoading:a,query:c}=this.state;if(null===r&&!a)return null;if(a)return(0,e.createElement)(s.Placeholder,{className:"foogallery-modal__content-placeholder",label:o},(0,e.createElement)(s.Spinner,null));if(null===r||!r.length)return(0,e.createElement)(s.Placeholder,{className:"foogallery-modal__content-placeholder",label:l});let d=this,u=c&&c.length>2,p=u?c.toLowerCase():"";return(u?r.filter((e=>-1!==e.lowerName.indexOf(p))):r).map((l=>(0,e.createElement)(i,{key:l.id,data:l,isSelected:n===l.id,isDisabled:-1!==t.indexOf(l.id),onSelected:e=>{d.setState({id:e})}})))}}d.defaultProps={currentId:0,isModalOpen:!1,className:"",title:(0,c.__)("Select the gallery you want to insert"),empty:(0,c.__)("No galleries found!"),insert:(0,c.__)("Insert Gallery"),reload:(0,c.__)("Reload Galleries"),loading:(0,c.__)("Loading galleries please wait..."),search:(0,c.__)("Search..."),disable:[],onRequestGalleryInsert:_.noop,onRequestModalClose:_.noop};var u=window.wp.blockEditor;class p extends e.Component{render(){const{select:t,onRequestModalOpen:l,canEdit:o,edit:n,onRequestGalleryEdit:r,canReload:a,reload:i,onRequestGalleryReload:c,remove:d,onRequestBlockRemove:p,children:h}=this.props;return(0,e.createElement)(u.BlockControls,null,(0,e.createElement)(s.ToolbarGroup,{className:"foogallery__toolbar-group"},(0,e.createElement)(s.ToolbarButton,{icon:"trash",label:d,onClick:p})),(0,e.createElement)(s.ToolbarGroup,{className:"foogallery__toolbar-group"},(0,e.createElement)(s.ToolbarButton,{icon:"format-gallery",label:t,onClick:l}),o?(0,e.createElement)(s.ToolbarButton,{icon:"edit",label:n,onClick:r}):null,a?(0,e.createElement)(s.ToolbarButton,{icon:"update",label:i,onClick:c}):null),h)}}p.defaultProps={canEdit:!1,canReload:!1,select:(0,c.__)("Select gallery","foogallery"),remove:(0,c.__)("Remove gallery","foogallery"),reload:(0,c.__)("Reload gallery","foogallery"),edit:(0,c.__)("Edit gallery","foogallery"),onRequestModalOpen:_.noop,onRequestBlockRemove:_.noop,onRequestGalleryEdit:_.noop,onRequestGalleryReload:_.noop};class h extends e.Component{render(){const{select:t,onRequestModalOpen:l,canEdit:o,edit:n,onRequestGalleryEdit:r,children:a}=this.props;return(0,e.createElement)(u.InspectorControls,null,(0,e.createElement)("div",{className:"foogallery-inspector-controls__button-container"},o?(0,e.createElement)(s.Button,{isSecondary:!0,onClick:r,icon:"edit",label:n}):null,"Â ",(0,e.createElement)(s.Button,{isPrimary:!0,onClick:l},t)),a)}}h.defaultProps={canEdit:!1,edit:(0,c.__)("Edit Gallery","foogallery"),select:(0,c.__)("Select Gallery","foogallery"),onRequestGalleryEdit:_.noop,onRequestModalOpen:_.noop};class m extends e.Component{render(){const{className:l,children:o,...n}=this.props;return(0,e.createElement)(s.Placeholder,t({className:a()("editor-media-placeholder foogallery__placeholder",l)},n),o)}}var y=window.wp.apiFetch,f=l.n(y),g=window.wp.url,b=window.lodash;class E extends e.Component{constructor(t){super(t),this.state={response:null,reload:t.reload},this.galleryRef=(0,e.createRef)()}static getDerivedStateFromProps(e,t){return e.reload!==t.reload?{response:null,reload:e.reload}:null}componentDidMount(){this.isStillMounted=!0,this.fetch(this.props),this.fetch=(0,b.debounce)(this.fetch,500)}componentWillUnmount(){this.isStillMounted=!1}shouldComponentUpdate(e,t){let l=!(0,b.isEqual)(this.props,e),o=!(0,b.isEqual)(this.state,t);return l||o}componentDidUpdate(e){(0,b.isEqual)(e,this.props)||this.fetch(this.props),null!=this.galleryRef.current&&jQuery(this.galleryRef.current).children(".foogallery").foogallery(FooGallery.autoDefaults)}fetch(e){if(!this.isStillMounted)return;null!==this.state.response&&this.setState({response:null});const{block:t,attributes:l=null,urlQueryArgs:o={}}=e,n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,g.addQueryArgs)(`/wp/v2/block-renderer/${e}`,{context:"edit",...null!==t?{attributes:t}:{},...l})}(t,l,o),r=this.currentFetchRequest=f()({path:n}).then((e=>{this.isStillMounted&&r===this.currentFetchRequest&&e&&this.setState({response:e.rendered})})).catch((e=>{this.isStillMounted&&r===this.currentFetchRequest&&this.setState({response:{error:!0,errorMsg:e.message}})}));return r}render(){const{loading:t,error:l,empty:o}=this.props,n=this.state.response;if(!n)return(0,e.createElement)(m,{instructions:t},(0,e.createElement)(s.Spinner,null));if(n.error){
// translators: %s: error message describing the problem
const t=(0,c.sprintf)(l,n.errorMsg);return(0,e.createElement)(m,{instructions:t})}return n.length?(0,e.createElement)("div",{dangerouslySetInnerHTML:{__html:n},ref:this.galleryRef}):(0,e.createElement)(m,{instructions:o})}}E.defaultProps={loading:(0,c.__)("Loading gallery...","foogallery"),error:(0,c.__)("Error loading gallery: %s","foogallery"),empty:(0,c.__)("No gallery was found.","foogallery")};class R extends e.Component{render(){const{icon:t,label:l,instructions:o,button:n,...r}=this.props;let a={icon:t,label:l,instructions:o};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(p,r),(0,e.createElement)(m,a,(0,e.createElement)(s.Button,{isSecondary:!0,onClick:r.onRequestModalOpen},n)),(0,e.createElement)(d,r),(0,e.createElement)(h,r))}}R.defaultProps={icon:"format-gallery",label:(0,c.__)("FooGallery","foogallery"),instructions:(0,c.__)("Select the gallery you want to insert.","foogallery"),button:(0,c.__)("Select Gallery","foogallery"),onRequestModalOpen:_.noop};class v extends e.Component{render(){const{icon:t,label:l,instructions:o,button:n,...r}=this.props;let a={icon:t,label:l,instructions:o};return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(p,r),(0,e.createElement)(m,a,(0,e.createElement)(s.Button,{isSecondary:!0,onClick:r.onRequestModalOpen},n)),(0,e.createElement)(d,r),(0,e.createElement)(h,r))}}v.defaultProps={icon:"format-gallery",label:(0,c.__)("FooGallery","foogallery"),instructions:(0,c.__)("Duplicate gallery, please select another to insert.","foogallery"),button:(0,c.__)("Select Gallery","foogallery"),onRequestModalOpen:_.noop};class w extends e.Component{render(){const{block:t,attributes:l,reload:o,...n}=this.props;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(p,n),(0,e.createElement)(E,{block:t,attributes:l,reload:o}),(0,e.createElement)(d,n),(0,e.createElement)(h,n))}}w.defaultProps={block:"fooplugins/foogallery",attributes:{},reload:!1,canEdit:!0,canReload:!0};var C=window.wp.data;const{editGalleryUrl:G}=window.FOOGALLERY_BLOCK;class M extends e.Component{constructor(){super(...arguments),this.state={isModalOpen:!1,reload:!1},this.showModal=this.showModal.bind(this),this.closeModal=this.closeModal.bind(this),this.insertGallery=this.insertGallery.bind(this),this.editGallery=this.editGallery.bind(this),this.reloadGallery=this.reloadGallery.bind(this),this.removeBlock=this.removeBlock.bind(this)}componentDidMount(){const{clientId:e,attributes:{id:t}}=this.props;0!==t&&n.add(t,e)}componentWillUnmount(){const{clientId:e,attributes:{id:t}}=this.props;0!==t&&n.remove(e)}showModal(){this.setState({isModalOpen:!0})}closeModal(){this.setState({isModalOpen:!1})}insertGallery(e){const{clientId:t,setAttributes:l}=this.props;n.update(e,t),l({id:e})}editGallery(){const{attributes:{id:e}}=this.props;let t=(0,c.sprintf)(G,e);window.open(t,"_blank")}reloadGallery(){const{reload:e}=this.state;this.setState({reload:!e})}removeBlock(){const{clientId:e}=this.props;(0,C.dispatch)("core/editor").removeBlock(e)}render(){const{attributes:l,clientId:o}=this.props,{isModalOpen:r,reload:a}=this.state;let s={disable:n.ids(),isModalOpen:r,onRequestModalOpen:this.showModal,onRequestModalClose:this.closeModal,onRequestBlockRemove:this.removeBlock,onRequestGalleryInsert:this.insertGallery,onRequestGalleryEdit:this.editGallery,onRequestGalleryReload:this.reloadGallery};return n.contains(l.id,o)?(0,e.createElement)(v,s):l.id?(0,e.createElement)(w,t({attributes:l,reload:a},s)):(0,e.createElement)(R,s)}}M.defaultProps={},(0,window.wp.blocks.registerBlockType)("fooplugins/foogallery",{title:(0,c.__)("FooGallery"),description:(0,c.__)("Insert a FooGallery into your content"),icon:"format-gallery",category:"media",keywords:[(0,c.__)("foogallery"),(0,c.__)("gallery")],supports:{multiple:!0,html:!1},attributes:{id:{type:"number",default:0},className:{type:"string"}},edit(t){return(0,e.createElement)(M,t)},save(){return null}})}()}();